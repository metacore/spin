*** m3.c	Wed Nov 13 14:49:44 1996
--- /spin/garrett/spin/gcc/m3.c.new	Wed Nov 13 18:12:23 1996
***************
*** 199,274 ****
  {
    /* C tables produced by gperf version 2.5 (GNU C++ version) */
    /* Command-line: gperf -o -j1 -i 1 -C -k 1-7,10,12,13 xx.xx  */
    static m3cg_opcode wordlist[] =
      {
!       0, 0, M3_SET_LABEL, 0, M3_NE, M3_EQ, 0, 0, 0, M3_GE, 0,
!       0, 0, 0, 0, 0, M3_GT, M3_SET_SOURCE_FILE, M3_SET_SOURCE_LINE, 0, 0, 0,
!       0, M3_FREE_TEMP, M3_NEGATE, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
!       M3_OR, 0, M3_POP, 0, M3_ZERO, 0, 0, 0, M3_ZERO_N, M3_NOT, M3_LE, 0,
!       M3_POP_PARAM, 0, M3_IF_NE, M3_IF_EQ, 0, M3_LT, 0, M3_IF_GE, 0, 0,
!       M3_ROTATE, 0, 0, 0, M3_IF_GT, 0, 0, M3_ROTATE_LEFT, 0, M3_COPY, 0,
!       M3_CHECK_EQ, M3_CHECK_NIL, M3_COPY_N, 0, 0, 0, 0, 0, 0,
!       M3_CHECK_RANGE, M3_ROTATE_RIGHT, 0, M3_EXTRACT, 0, M3_EXTRACT_N,
!       M3_CHECK_HI, M3_EXTRACT_MN, 0, M3_XOR, 0, 0, 0, 0, 0, 0, 0, M3_IF_LE,
!       0, 0, 0, 0, 0, 0, M3_IF_LT, 0, 0, 0, M3_INIT_PROC, 0, 0,
!       M3_BEGIN_BLOCK, 0, M3_INIT_VAR, M3_EXIT_PROC, M3_CVT_FLOAT,
!       M3_CHECK_LO, 0, M3_CHECK_INDEX, 0, M3_SWAP, 0, 0, 0, M3_FLOOR, 0, 0,
!       M3_SET_NE, M3_SET_EQ, 0, 0, M3_SET_RANGE, M3_SET_GE, M3_ABS,
!       M3_BEGIN_INIT, 0, 0, 0, 0, M3_SET_GT, M3_CASE_FAULT, 0, 0, 0, 0, 0,
!       M3_INIT_OFFSET, 0, 0, 0, M3_INIT_INT, 0, M3_EXPORT_UNIT, M3_AND, 0, 0,
!       M3_CEILING, 0, 0, 0, M3_STORE, 0, M3_INIT_FLOAT, 0, 0, 0,
!       M3_STORE_REF, 0, 0, 0, M3_INSERT, 0, M3_SET_LE, M3_INSERT_N,
!       M3_INSERT_MN, M3_POP_STRUCT, M3_CALL_INDIRECT, 0, 0, M3_SET_LT, 0, 0,
!       0, M3_SHIFT, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, M3_MIN, 0, 0, 0, 0,
!       M3_INIT_LABEL, M3_MAX, M3_DIV, 0, 0, 0, 0, M3_SHIFT_RIGHT, 0, 0, 0,
!       M3_IF_FALSE, 0, 0, 0, 0, 0, 0, M3_DECLARE_SET, 0, M3_DECLARE_TEMP, 0,
!       0, 0, M3_LOOPHOLE, 0, 0, M3_DECLARE_OPEN_ARRAY, 0, 0, 0, M3_TRUNC, 0,
!       M3_DECLARE_PROCEDURE, 0, M3_LOAD, 0, 0, 0, M3_DECLARE_PROCTYPE, 0,
!       M3_INIT_CHARS, M3_DECLARE_ARRAY, M3_SHIFT_LEFT, 0,
!       M3_DECLARE_TYPENAME, M3_START_CALL_INDIRECT, 0, M3_END_INIT,
!       M3_DECLARE_OBJECT, 0, M3_DECLARE_PACKED, 0, 0, 0, 0, 0, 0,
!       M3_DECLARE_RECORD, 0, 0, 0, M3_END_BLOCK, 0, 0, 0, M3_DECLARE_POINTER,
!       M3_STORE_INDIRECT, M3_DECLARE_INDIRECT, 0, M3_POP_STATIC_LINK,
!       M3_IF_TRUE, 0, M3_DECLARE_METHOD, M3_NARROW_FAULT,
!       M3_DECLARE_EXCEPTION, 0, 0, 0, 0, M3_NOTE_PROCEDURE_ORIGIN,
!       M3_REVEAL_OPAQUE, 0, 0, 0, M3_LOAD_NIL, 0, M3_DECLARE_GLOBAL, 0, 0, 0,
!       0, 0, M3_IMPORT_UNIT, 0, 0, M3_LOAD_INTEGER, M3_LOAD_FLOAT, 0,
!       M3_BEGIN_UNIT, 0, M3_ADD, M3_DECLARE_LOCAL, 0, 0, 0, 0,
!       M3_LOAD_INDIRECT, 0, 0, 0, 0, 0, M3_CALL_DIRECT, M3_SET_INTER,
!       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, M3_SET_SING, M3_STORE_REF_INDIRECT,
!       0, 0, 0, 0, 0, M3_DECLARE_RAISES, 0, M3_IMPORT_GLOBAL, M3_MOD, 0,
!       M3_SET_DIFF, 0, M3_CASE_JUMP, 0, 0, 0, 0, 0, 0, M3_BIND_SEGMENT,
!       0, 0, 0, 0, 0, 0, M3_END_PROCEDURE, 0, M3_ADD_OFFSET, 0, 0, 0, 0, 0,
!       0, M3_JUMP, 0, M3_SUBTRACT, 0, 0, M3_DECLARE_ENUM, 0,
!       M3_DECLARE_PARAM, 0, M3_DECLARE_SEGMENT, M3_DECLARE_ENUM_ELT, 0, 0, 0,
!       M3_DECLARE_CONSTANT, 0, 0, 0, 0, 0, M3_SET_UNION, 0, 0, 0, 0, 0, 0, 0,
!       0, 0, M3_START_CALL_DIRECT, 0, 0, 0, 0, 0, 0, M3_DIVIDE, M3_ROUND, 0,
!       0, 0, 0, M3_DECLARE_FORMAL, 0, M3_GET_RUNTIME_HOOK, 0, 0, 0, 0, 0,
!       M3_END_UNIT, 0, 0, 0, 0, 0, M3_TYPECASE_FAULT, 0, 0, 0, 0, 0, 0, 0,
!       M3_SET_MEMBER, 0, 0, 0, 0, M3_DECLARE_OPAQUE, M3_DECLARE_SUBRANGE, 0,
!       0, 0, 0, 0, 0, M3_IMPORT_PROCEDURE, 0, 0, 0, 0, 0, 0, 0, 0, 0,
!       M3_RETURN_FAULT, 0, 0, 0, M3_BEGIN_PROCEDURE, 0, 0,
!       M3_LOAD_STATIC_LINK, M3_DECLARE_FIELD, M3_LOAD_PROCEDURE,
!       M3_ASSERT_FAULT, 0, M3_SET_SDIFF, 0, 0, 0, 0, 0, 0, 0, 0, 0,
!       0, 0, 0, 0, 0, 0, 0, 0, M3_INDEX_ADDRESS, 0, 0, 0, 0, 0, 0, 0, 0, 0,
!       0, 0, 0, 0, 0, 0, M3_SET_RUNTIME_PROC, 0, 0, 0, 0, 0, 0, 0, 0,
!       M3_LOAD_ADDRESS, 0, 0, 0, M3_MULTIPLY, 0, M3_SET_RUNTIME_HOOK, 
      };
    static const unsigned short asso_values[] =
      {
!      513, 513, 513, 513, 513, 513, 513, 513, 513, 513,
!      513, 513, 513, 513, 513, 513, 513, 513, 513, 513,
!      513, 513, 513, 513, 513, 513, 513, 513, 513, 513,
!      513, 513, 513, 513, 513, 513, 513, 513, 513, 513,
!      513, 513, 513, 513, 513,   1,   1, 513, 513, 513,
!      513, 513, 513, 513, 513, 513, 513, 513, 513, 513,
!      513, 513, 513, 513, 513, 513, 513, 513, 513, 513,
!        2, 513, 513,   1, 513, 513,   3, 513, 513, 513,
!      513, 513, 513, 513, 513, 513, 513, 513, 513, 513,
!      513, 513, 513, 513, 513,   1, 513,   1,  20,   8,
!      149,   1,   1,   6,  16,  44,   1,  29,  46, 148,
!        1,  36,   1,   2,   1, 110,   8, 209,   7,   5,
!       50,  21,   1, 513, 513, 513, 513, 513,
      };
    register int hval;
  
--- 199,338 ----
  {
    /* C tables produced by gperf version 2.5 (GNU C++ version) */
    /* Command-line: gperf -o -j1 -i 1 -C -k 1-7,10,12,13 xx.xx  */
+   /* Recipe for making this table.
+      1. Copy m3.def to a temporary file.
+         Remove everything except for one keyword
+ 	and one M3_*** identifier per line, separated by
+ 	a comma.
+ 	Add a structure definition at the beginning of
+ 	the file.
+      2. Run the gperf command on this file.
+      3. Take the tables from the gperf output and
+         paste them in below.
+   */
    static m3cg_opcode wordlist[] =
      {
! 	0, 0, M3_SET_LABEL, 0, 0, M3_EQ, 0, 0, 0,
! 	M3_GE, 0, 0, 0, 0, 0, M3_LE, M3_GT, M3_SET_SOURCE_FILE,
! 	M3_SET_SOURCE_LINE, 0, 0, 0, M3_LT, M3_FREE_TEMP,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, M3_IF_EQ, 0, 0,
! 	0, M3_IF_GE, 0, 0, 0, 0, 0, M3_IF_LE, M3_IF_GT,
! 	0, M3_EXIT_PROC, 0, 0, 0, M3_IF_LT, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, M3_OR, 0, M3_POP,
! 	M3_XOR, M3_ZERO, 0, 0, 0, 0, 0, 0, M3_SET_EQ,
! 	0, 0, 0, M3_SET_GE, M3_COPY, 0, 0, 0, 0, M3_SET_LE,
! 	M3_SET_GT, M3_IF_TRUE, 0, 0, 0, 0, M3_SET_LT,
! 	0, 0, 0, 0, 0, 0, 0, 0, M3_CVT_FLOAT, 0, 0,
! 	0, 0, 0, 0, 0, M3_EXPORT_UNIT, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, M3_STORE, 0, 0, 0, 0, 0, M3_STORE_REF,
! 	0, 0, M3_FLOOR, M3_DIV, 0, 0, 0, 0, M3_POP_STRUCT,
! 	0, M3_NE, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, M3_IF_NE, 0, 0, 0, 0, M3_JUMP, 0, M3_SHIFT,
! 	0, 0, 0, 0, 0, M3_STORE_INDIRECT, M3_CHECK_EQ,
! 	0, 0, 0, 0, 0, 0, 0, 0, M3_CHECK_RANGE, 0,
! 	M3_CHECK_LO, M3_TRUNC, 0, 0, 0, 0, 0, 0, M3_SHIFT_LEFT,
! 	0, M3_INIT_PROC, 0, M3_ZERO_N, M3_NOT, M3_SET_NE,
! 	M3_CHECK_INDEX, 0, M3_CEILING, 0, 0, 0, 0,
! 	0, 0, M3_COPY_N, 0, 0, 0, 0, 0, M3_INIT_FLOAT,
! 	0, 0, 0, 0, 0, M3_INSERT, 0, M3_MULTIPLY,
! 	M3_INSERT_N, M3_INSERT_MN, 0, 0, 0, M3_CHECK_SIZE,
! 	0, 0, 0, 0, 0, 0, 0, M3_BEGIN_INIT, 0, 0,
! 	0, 0, 0, M3_IMPORT_UNIT, M3_BEGIN_BLOCK, M3_RETURN_FAULT,
! 	0, 0, 0, 0, 0, 0, 0, 0, M3_DIVIDE, M3_INIT_OFFSET,
! 	M3_BEGIN_UNIT, 0, M3_EXTRACT, 0, M3_EXTRACT_N,
! 	M3_CHECK_HI, 0, M3_SHIFT_RIGHT, M3_NOTE_PROCEDURE_ORIGIN,
! 	0, M3_SET_UNION, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, M3_MOD, 0, 0, M3_MIN, M3_LOOPHOLE,
! 	0, 0, 0, 0, M3_SET_SDIFF, M3_SWAP, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, M3_SET_INTER, M3_POP_PARAM,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, M3_ROTATE, 0, M3_CHECK_NIL,
! 	0, 0, 0, 0, M3_ROTATE_LEFT, M3_SET_MEMBER,
! 	0, M3_ABS, 0, 0, 0, 0, 0, 0, M3_IF_FALSE,
! 	0, 0, 0, M3_ROTATE_RIGHT, M3_SET_DIFF, 0,
! 	M3_INIT_CHARS, M3_ROUND, M3_CASE_JUMP, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, M3_END_BLOCK, 0, 0,
! 	0, 0, 0, 0, M3_INIT_INT, 0, M3_BEGIN_PROCEDURE,
! 	0, 0, M3_DECLARE_SET, 0, M3_DECLARE_TEMP,
! 	M3_MAX, 0, 0, M3_BIND_SEGMENT, 0, M3_DECLARE_PROCEDURE,
! 	M3_DECLARE_EXCEPTION, 0, 0, 0, M3_STORE_REF_INDIRECT,
! 	M3_DECLARE_PROCTYPE, 0, M3_TYPECASE_FAULT,
! 	0, 0, M3_SUBTRACT, 0, M3_SET_RUNTIME_PROC,
! 	0, 0, 0, 0, M3_IMPORT_PROCEDURE, 0, 0, 0,
! 	0, 0, M3_NEGATE, M3_CALL_DIRECT, 0, 0, 0,
! 	0, 0, 0, M3_DECLARE_OBJECT, M3_EXTRACT_MN,
! 	0, M3_POP_STATIC_LINK, 0, 0, M3_LOAD, M3_DECLARE_OPAQUE,
! 	0, M3_ASSERT_FAULT, M3_END_PROCEDURE, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, M3_GET_RUNTIME_HOOK,
! 	M3_DECLARE_RECORD, M3_CHECK_ALIGN, 0, 0, 0,
! 	M3_END_INIT, 0, 0, 0, 0, 0, 0, M3_LOAD_FLOAT,
! 	0, 0, M3_ADD, 0, 0, 0, M3_INIT_VAR, M3_CALL_INDIRECT,
! 	M3_SET_RANGE, 0, 0, M3_END_UNIT, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, M3_START_CALL_DIRECT, 0,
! 	0, M3_INIT_LABEL, 0, 0, 0, M3_LOAD_PROCEDURE,
! 	0, 0, 0, 0, M3_SET_RUNTIME_HOOK, 0, 0, 0,
! 	0, 0, 0, M3_AND, 0, 0, 0, 0, M3_SET_SING,
! 	0, 0, M3_DECLARE_CONSTANT, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, M3_DECLARE_SEGMENT, 0, M3_NARROW_FAULT,
! 	M3_START_CALL_INDIRECT, 0, M3_DECLARE_FIELD,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, M3_DECLARE_OPEN_ARRAY,
! 	M3_DECLARE_METHOD, 0, 0, 0, M3_ADD_OFFSET,
! 	0, 0, M3_LOAD_STATIC_LINK, 0, M3_DECLARE_TYPENAME,
! 	0, 0, M3_DECLARE_ALIGNED, 0, 0, 0, 0, 0, 0,
! 	M3_DECLARE_INDIRECT, 0, 0, 0, 0, M3_IMPORT_GLOBAL,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, M3_CASE_FAULT,
! 	0, 0, 0, 0, M3_REVEAL_OPAQUE, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, M3_DECLARE_POINTER,
! 	0, 0, 0, 0, M3_LOAD_NIL, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, M3_LOAD_INTEGER, 0, 0, 0, M3_LOAD_INDIRECT,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, M3_DECLARE_ARRAY,
! 	0, 0, M3_INDEX_ADDRESS, 0, 0, 0, 0, 0, 0,
! 	0, 0, M3_DECLARE_ENUM, 0, 0, 0, 0, M3_DECLARE_ENUM_ELT,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	M3_DECLARE_SUBRANGE, 0, 0, M3_DECLARE_GLOBAL,
! 	0, 0, 0, 0, 0, M3_DECLARE_RAISES, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, M3_DECLARE_LOCAL,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, M3_DECLARE_PACKED, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, M3_DECLARE_FORMAL,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, M3_LOAD_ADDRESS, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
! 	0, 0, 0, M3_DECLARE_PARAM
      };
    static const unsigned short asso_values[] =
      {
!      983, 983, 983, 983, 983, 983, 983, 983, 983, 983,
!      983, 983, 983, 983, 983, 983, 983, 983, 983, 983,
!      983, 983, 983, 983, 983, 983, 983, 983, 983, 983,
!      983, 983, 983, 983, 983, 983, 983, 983, 983, 983,
!      983, 983, 983, 983, 983,   1,   1, 983, 983, 983,
!      983, 983, 983, 983, 983, 983, 983, 983, 983, 983,
!      983, 983, 983, 983, 983, 983, 983, 983, 983, 983,
!        2, 983, 983,   1, 983, 983,   3, 983, 983, 983,
!      983, 983, 983, 983, 983, 983, 983, 983, 983, 983,
!      983, 983, 983, 983, 983,   1, 983, 241,  36,   1,
!      102,   1,   1,   6,  88,  23,   1,  84,  12, 128,
!      140,  58,   1,   2,   1,  53,   8,  42,   8,   2,
!        2,  13,   1, 983, 983, 983, 983, 983,
      };
    register int hval;
  
